<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>FITMATE | 식단 상세 보기</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/history/historyDetail.css">
    <link rel="stylesheet" href="/css/history/history.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
<div class="wrapper">
    <header class="main-header" th:replace="~{index :: .main-header}"></header>

    <main class="detail-main-content">
        <div class="detail-container" th:if="${detailData != null}">
            <h1 th:text="${detailData.dietType} + ' 식단'">식단 제목</h1>
            <p class="subtitle" th:text="${detailData.regDt} + ' 저장됨'"></p>

            <div class="routine-section">
                <h2><i class="fa-solid fa-utensils"></i> 주간 식단 정보</h2>
                <div th:each="entry : ${dietMap}" class="day-routine-card">
                    <h3 th:text="${entry.key}">요일</h3>
                    <table>
                        <thead>
                        <tr>
                            <th>구분</th>
                            <th>식단</th>
                            <th>칼로리</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="meal : ${entry.value}">
                            <td th:text="${meal.mealTime}"></td>
                            <td th:text="${meal.menu}"></td>
                            <td th:text="${meal.calories}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="bottom-actions">
                <a th:href="@{/history/view}" class="back-link">목록으로 돌아가기</a>
                <button type="button" class="delete-btn js-delete-trigger">주간 식단 삭제</button>
            </div>
        </div>

    </main>
</div>

<div id="deleteModal" class="modal-overlay">
    <div class="modal-content">
        <i class="fa-solid fa-triangle-exclamation modal-icon"></i>
        <h2>기록을 삭제하시겠습니까?</h2>
        <p>이 작업은 되돌릴 수 없습니다.</p>
        <div class="modal-actions">
            <button id="cancelDelete" type="button" class="modal-btn cancel-btn">취소</button>
            <form id="confirmDeleteForm" method="post" style="display: inline;">
                <button type="submit" class="modal-btn delete-btn">삭제</button>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/js/header.js}"></script>

<script th:inline="javascript">
    // HTML 문서가 모두 로드된 후 스크립트를 실행합니다.
    document.addEventListener('DOMContentLoaded', function () {
        // 필요한 HTML 요소들을 변수에 저장합니다.
        const deleteButton = document.querySelector('.js-delete-trigger');
        const deleteModal = document.getElementById('deleteModal');
        const cancelDeleteBtn = document.getElementById('cancelDelete');
        const confirmDeleteForm = document.getElementById('confirmDeleteForm');

        // Controller로부터 전달받은 현재 게시물의 고유 ID를 가져옵니다.
        const detailId = /*[[${detailData?.id}]]*/ null;

        // 삭제 버튼과 ID가 모두 존재할 경우에만 삭제 로직을 활성화합니다.
        if (deleteButton && detailId) {

            // '리포트 삭제' 버튼을 클릭했을 때의 동작입니다.
            deleteButton.addEventListener('click', function() {
                // 삭제를 요청할 URL을 생성합니다. (예: /history/diet/delete/고유ID)
                const deleteUrl = '/history/diet/delete/' + detailId;
                // 모달창 내부 form의 action 속성에 생성한 URL을 설정합니다.
                confirmDeleteForm.setAttribute('action', deleteUrl);
                // 모달에 'show' 클래스를 추가하여 화면에 표시합니다.
                deleteModal.classList.add('show');
            });

            // 모달창의 '취소' 버튼을 클릭했을 때의 동작입니다.
            cancelDeleteBtn.addEventListener('click', function() {
                deleteModal.classList.remove('show');
            });

            // 모달창 바깥의 어두운 영역을 클릭했을 때의 동작입니다.
            deleteModal.addEventListener('click', function(event) {
                if (event.target === deleteModal) {
                    deleteModal.classList.remove('show');
                }
            });
        }
    });
</script>

</body>
</html>