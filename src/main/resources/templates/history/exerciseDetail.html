<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>FITMATE | 운동 상세 보기</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/exercise/exerciseResult.css">
    <link rel="stylesheet" href="/css/history/history.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
<div class="wrapper">
    <header class="main-header" th:replace="~{index :: .main-header}"></header>

    <main class="result-main-content">
        <div class="result-container" th:if="${detailData != null}">
            <h1 th:text="${detailData.exerciseGoal} + ' 루틴'">운동 루틴 제목</h1>
            <p th:text="${detailData.regDt} + '에 저장된 기록입니다.'"></p>

            <div class="table-container">
                <table>
                    <thead>
                    <tr>
                        <th>요일</th>
                        <th>운동 부위</th>
                        <th>운동 이름</th>
                        <th>세트</th>
                        <th>횟수</th>
                        <th>휴식 시간</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="routine : ${detailData.weeklyRoutine}">
                        <td th:text="${routine.day}"></td>
                        <td th:text="${routine.bodyPart}"></td>
                        <td th:text="${routine.exerciseName}"></td>
                        <td th:text="${routine.sets}"></td>
                        <td th:text="${routine.reps}"></td>
                        <td th:text="${routine.restTime}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="action-buttons">
                <a th:href="@{/history/view}" class="btn-home"><i class="fa-solid fa-list"></i> 목록으로 돌아가기</a>
                <button type="button" class="btn-retry js-delete-trigger"><i class="fa-solid fa-trash"></i> 루틴 삭제하기</button>
            </div>
        </div>

        <div class="result-container" th:if="${detailData == null}">
            <h1><i class="fa-solid fa-circle-exclamation"></i> 조회 결과 없음</h1>
            <p>요청하신 정보를 찾을 수 없거나 접근 권한이 없습니다.</p>
            <div class="action-buttons">
                <a th:href="@{/history/view}" class="btn-home"><i class="fa-solid fa-list"></i> 목록으로 돌아가기</a>
            </div>
        </div>
    </main>
</div>

<div id="deleteModal" class="modal-overlay">
    <div class="modal-content">
        <i class="fa-solid fa-triangle-exclamation modal-icon"></i>
        <h2>기록을 삭제하시겠습니까?</h2>
        <p>이 작업은 되돌릴 수 없습니다.</p>
        <div class="modal-actions">
            <button id="cancelDelete" type="button" class="modal-btn cancel-btn">취소</button>
            <form id="confirmDeleteForm" method="post" style="display: inline;">
                <button type="submit" class="modal-btn delete-btn">삭제</button>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/js/header.js}"></script>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
        const deleteButton = document.querySelector('.js-delete-trigger');
        const deleteModal = document.getElementById('deleteModal');
        const cancelDeleteBtn = document.getElementById('cancelDelete');
        const confirmDeleteForm = document.getElementById('confirmDeleteForm');
        const detailId = /*[[${detailData?.id}]]*/ null;

        if (deleteButton && detailId) {
            deleteButton.addEventListener('click', function() {
                const deleteUrl = '/history/exercise/delete/' + detailId;
                confirmDeleteForm.setAttribute('action', deleteUrl);
                deleteModal.classList.add('show');
            });
            cancelDeleteBtn.addEventListener('click', () => deleteModal.classList.remove('show'));
            deleteModal.addEventListener('click', e => {
                if (e.target === deleteModal) deleteModal.classList.remove('show');
            });
        }
    });
</script>

</body>
</html>